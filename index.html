<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bel√∂ningar</title>
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #1a1a2e;
        color: #fff;
        display: flex;
        justify-content: center;
        padding: 20px;
        min-height: 100vh;
        margin: 0;
    }

    .card {
        background: #16213e;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        width: 100%;
        max-width: 400px;
        text-align: center;
        border: 2px solid #e94560;
    }

    .hidden { display: none; }

    h1 {
        color: #e94560;
        margin-bottom: 10px;
        font-size: 1.8rem;
    }

    p {
        color: #95a5a6;
        font-size: 0.9rem;
    }

    input {
        background: #0f3460;
        border: 2px solid #533483;
        color: white;
        padding: 12px;
        border-radius: 10px;
        width: 80%;
        font-size: 1.2rem;
        text-align: center;
        margin-bottom: 20px;
        outline: none;
    }

    .btn {
        background: #e94560;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        text-transform: uppercase;
        transition: 0.2s;
    }

    .btn:hover {
        transform: scale(1.05);
        background: #ff5e78;
    }

    .stat-container {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
    }

    .stat-box {
        background: #0f3460;
        padding: 10px;
        border-radius: 12px;
        width: 42%;
        border-bottom: 3px solid #e94560;
    }

    .stat-label {
        font-size: 0.7rem;
        color: #e94560;
        text-transform: uppercase;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .xp-bar-container {
        background: #0f3460;
        border-radius: 15px;
        height: 18px;
        width: 100%;
        margin: 10px 0;
        overflow: hidden;
        border: 1px solid #533483;
    }

    .xp-bar-fill {
        background: linear-gradient(90deg, #e94560, #ff5e78);
        height: 100%;
        width: 0%;
        transition: width 0.6s ease;
    }

    .shop-container {
        margin-top: 30px;
        text-align: left;
        border-top: 1px solid #533483;
        padding-top: 20px;
    }

    .shop-title {
        color: #e94560;
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .reward-item {
        background: #0f3460;
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 4px solid #533483;
        transition: 0.2s;
    }

    .reward-item.affordable {
        border-left-color: #2ecc71;
        cursor: pointer;
    }

    .reward-item.affordable:hover {
        transform: scale(1.02);
        background: #14325a;
    }

    .reward-item.locked {
        opacity: 0.45;
        filter: grayscale(0.6);
        cursor: not-allowed;
    }

    .reward-name {
        font-weight: bold;
        font-size: 0.95rem;
    }

    .reward-status {
        font-size: 0.75rem;
        color: #95a5a6;
    }

    .cost-tag {
        background: #1a1a2e;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: bold;
        color: #e94560;
    }
</style>
</head>
<body>

<div class="card" id="login-screen">
    <h1>Logga in</h1>
    <p>Ange din kod f√∂r att se dina bel√∂ningar</p>
    <input type="password" id="hero-code" placeholder="****">
    <br>
    <button class="btn" onclick="login()">Logga in</button>
</div>

<div class="card hidden" id="dashboard">
    <h1 id="hero-name">Elev</h1>
    <div class="stat-container">
        <div class="stat-box">
            <div class="stat-label">Level</div>
            <div class="stat-value" id="lvl-val">1</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">XP</div>
            <div class="stat-value" id="xp-val">0</div>
        </div>
    </div>
    <div class="xp-bar-container">
        <div class="xp-bar-fill" id="xp-bar"></div>
    </div>

    <div class="shop-container">
        <div class="shop-title">üéÅ Dina bel√∂ningar</div>
        <div id="rewards-list"></div>
    </div>

    <br>
    <button class="btn" onclick="location.reload()" style="background:#533483;font-size:0.7rem;">Logga ut</button>
</div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSrFn8zqTcXlK23eOdZSZcNvFRSMvlM8D9NwFxns5V9tOguvrrqXEczF_KEjGw9F7VqhADFC1k7763e/pub?output=csv";
const updateXpUrl = "https://script.google.com/macros/s/AKfycbyIX0kT_qcBgKMvY4Ou0JeUZuIiktYexQtq_Op2O0VcesCGlYIbWVs59Y7pz49Q6XURZg/exec";

const rewards = [
    { name: "5 min extra rast", cost: 375, cat: "Allm√§nt" },
    { name: "Kolla p√• Youtube", cost: 1250, cat: "Allm√§nt" },
    { name: "Sitta inne en rast", cost: 375, cat: "Allm√§nt" },
    { name: "Slippa anteckna Stj√§rnklart", cost: 375, cat: "Allm√§nt" },
    { name: "Ta det lugnt p√• min plats", cost: 375, cat: "Allm√§nt" },
    { name: "Multiplikationsspel 15 min", cost: 375, cat: "Allm√§nt" },
    { name: "Slippa g√• till lilla studion 1 g√•ng", cost: 650, cat: "Maja, Allm√§nt" },
    { name: "Hemlig √∂verraskning!", cost: 1875, cat: "Elias" }
];

async function login() {
    const code = document.getElementById("hero-code").value.trim();
    const res = await fetch(sheetUrl + "&cb=" + Math.random());
    const text = await res.text();
    const rows = text.replace(/^\uFEFF/, "").split("\n").map(r => r.split(","));
    const student = rows.find(r => r[0].replace(/"/g,"").trim() === code);
    if (!student) return alert("Fel kod!");

    window.currentStudentCode = code;

    const name = student[1].replace(/"/g,"").trim();
    const xp = parseInt(student[2]) || 0;
    const lvl = student[3];
    const category = student[4] ? student[4].replace(/"/g,"").trim() : "Allm√§nt";

    displayHero(xp, lvl, name, category);
}

function displayHero(xp, lvl, name, category) {
    document.getElementById("login-screen").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");

    document.getElementById("hero-name").innerText = name.toUpperCase();
    document.getElementById("xp-val").innerText = xp;
    document.getElementById("lvl-val").innerText = lvl;
    document.getElementById("xp-bar").style.width = (xp % 1000)/10 + "%";

    const list = document.getElementById("rewards-list");
    list.innerHTML = "";

    rewards.forEach(item => {
        const cats = item.cat.split(",").map(c => c.trim());
        if (!(cats.includes("Allm√§nt") || cats.includes(category) || cats.includes(name))) return;

        const affordable = xp >= item.cost;
        const div = document.createElement("div");
        div.className = "reward-item " + (affordable ? "affordable" : "locked");
        div.innerHTML = `
            <div>
                <div class="reward-name">${item.name}</div>
                <div class="reward-status">
                    ${affordable ? "üü¢ Klicka f√∂r att k√∂pa" : `üîí L√•st ‚Äì saknar ${item.cost - xp} XP`}
                </div>
            </div>
            <div class="cost-tag">${item.cost} XP</div>
        `;

        if (affordable) {
            div.onclick = async () => {
                if (!confirm(`Vill du anv√§nda ${item.cost} XP f√∂r:\n\n${item.name}?`)) return;

                try {
                    const res = await fetch(updateXpUrl, {
                        method: "POST",
                        body: JSON.stringify({
                            code: window.currentStudentCode,
                            cost: item.cost,
                            reward: item.name
                        })
                    });
                    const result = await res.json();
                    if (!result.success) return alert("N√•got gick fel");
                    displayHero(result.xp, lvl, name, category);
                } catch(e) {
                    alert("Kunde inte kontakta Google Sheet");
                }
            };
        }

        list.appendChild(div);
    });
}
</script>

</body>
</html>
